import{m as de,l as ke,_ as Fe}from"./loginOut.10c3f0c9.js";import{s as X,n as Se,f as Ie,m as Ce,u as Ue,a as $e,b as Ne,c as Te,g as ae,F as Be,d as Ee,r as Le,_ as Me}from"./toast.5031a956.js";import{a7 as U,f as k,h as C,i as l,E as D,O as y,M as J,P as B,J as P,A as ne,U as De,d as Pe,v as ze,n as Re,K as R,Q as W,u as N,I as Y,D as j,F as Q,_ as q,ak as le,al as re,N as We}from"./vue.9201f2e4.js";import{l as oe,o as ce,t as L,z as me,A as ue,H as je,B as Oe,_ as H,D as E,E as T,v as Ye,c as we,F as Qe,G as He,I as Ke,K as Ve,L as Ge,k as O,M as Je,N as Xe,O as qe,P as Ze,Q as et,R as tt,S as ot,T as st}from"./index.0601cc40.js";import{S as ve}from"./spark-md5.2cc5764b.js";import{E as ie}from"./element-plus.02c3c9a9.js";import{s as at}from"./serviceworkerUtil.9d961b55.js";import{g as pe,d as Z}from"./diskCommon.74a9f77c.js";import"./touxiang.0d655065.js";import"./lodash.51aea353.js";import"./crypto-js.53c8803a.js";var it="./assets/arrowgray.12951361.svg",nt="./assets/arrow-right.492faba9.svg",lt="./assets/file.2405a53a.svg",rt="./assets/filegray.604a2915.svg",ct="./assets/person.65abf2df.svg",dt="./assets/persongray.ff383b7b.svg",be="./assets/chuanshu.93ed7f50.svg",ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAfNJREFUWEfN101LG0EYB/D/k6TZGE859hIQD0a0WvCFFjyoaRHxlJZS4hfw7AtK6SU9bCo95FC/gYKImKTQY7AFb2I2idBD0oIHC72IIAhiTd1HEjyF7OxOMhu7152d5zcz/5lhCYAXD/iQCsDUj/Qzn9cTzvXHdmXHogTw4ueXE2YOg/nzfuTVkgxCFeCMmUP1wpII9QBJhDsACYR7AIeItgHPd1P+4NOeczC6mobPJhO2gGhppxcBbZaImxcgzwQzzwmTL0AIAVOlvYgn6D2yHJ3MfrNACAHRSuY9QB9k6sjOhBhQziZBWFUGaBJMG0BGB9GaUkADQgh4WcnOm8CmcgAAj4n52t0hBEwmEuSLD6cAeg2y2Gat6S7Nv9X4tydvDm23YWv9O//q/wAMrRwH/P6hHAMR53ZxSwJMJhi3txcLpfXQb6vW9RkYWf4TIu3xKUPpOtdrEiGd1+mtEFB7OfrueoZJywDQVM3CfT9lI0mDtgC3EESo5HUacARwBUEoGDqNOwaoRhCZi3nduyEFcIwg/AKbW2BUGwvUdgFxtXC0HvguypTwHLANJt/EjI/a13ZCa3sQiRHX00ay68BVgHg5OgSwRnQQ0BzRYUAjwvx3NVb81F10PQONBUZXr0bwyN+X133b7RSv3xUq/o7bQdwBtSfhgTO+b/EAAAAASUVORK5CYII=";function pt(e){let{resolve:o,rej:t,promise:a}=oe(),s=e.length,i=null;return e.length>0&&(i=e[s-1]),{prePromise:i,resolve:o,reject:t,curPromise:a}}function ht(e){return e.every(o=>o!=-1)}function ye(e){let o=Object.keys(e);o.sort((a,s)=>parseInt(a)>parseInt(s)?1:-1);let t=[];return o.forEach(a=>{let i=e[a].saveKey;t.push(ce(i))}),Promise.all(t)}function _e(e){let o=0,t=0;for(let i=0;i<e.length;i++){let u=e[i];u&&(o=o+u.total,t=t+u.loaded)}let a=parseInt(t||"0")/parseInt(o||"100")*100,s=Number(a).toFixed(2);return{total:o,loaded:t,percent:s}}let ee=1024*1024*2*2,V={},ft=X({count:3,retryCount:0});async function gt(e,o){return mt(e,o,ft,3)}async function mt(e,o,t,a){let s=X({count:a,retryCount:1}),{pause:i,continueRun:u,start:w,retryTask:h}=s;window.addEventListener("offline",i),window.addEventListener("online",u);let{start:v,removeFn:_}=t,{success:g,progress:x,fail:F,begin:S}=e,d=o.betag;V[d]=V[d]||[];let{prePromise:A,resolve:b,reject:I,curPromise:n}=pt(V[d]);V[d].push(n);let r=(...m)=>{b(),g&&g(...m)},p=m=>{console.log("\u4E0B\u8F7Dfail:",m),F&&F(m),I()};A=A||Promise.resolve();let{resolve:f,promise:c}=oe();return A.then(()=>{ce(`${o.betag}-sequelDownInfo`).then(m=>{m=m||{};let $={progressTotal:x,totalFailWrap:p,totalSuccessWrap:r},M=wt(o,m,e,$,h);if(M.length==0){vt(o,$);return}let K=async Ae=>{w(M);try{await n}catch{}finally{Ae()}};v(K),S(),f(K)})}),{cancel:()=>{c.then(m=>{_(m)}),s.stop(),window.removeEventListener("online",u),window.removeEventListener("offline",i),V[d]=[],t.next()},pause:()=>{i()},resume:()=>{u()}}}function wt(e,o,t,a,s){let{progressTotal:i,totalSuccessWrap:u,totalFailWrap:w}=a,{size:h}=e,v=[],_=h%ee==0?h/ee:parseInt(h/ee+"")+1,g=0,x=0,F=new Array(_),S=new Array(_).fill(-1),d={},A=0;for(;x<h;){let b=x+ee;if(b>h&&(b=h),o[g])S[g]=1;else{let{tmpOption:I,saveKey:n,index:r}=bt(x,b,g,F,t,e,d,i),p=f=>{if(I.success=async(c,m)=>{A++,f();try{let $=await yt(S,r,n,m,e,d);$&&u(null,$,{httpNum:A,totalNum:_})}catch($){console.log("\u4E0B\u8F7D\u53D1\u9001\u9519\u8BEF:",$)}},I.fail=c=>{c&&c.code===1003?(console.log(c),w(c)):s(p,()=>{console.log(`\u7B2C${r+1}\u4E0B\u8F7D\u5931\u8D25\u56DE\u8C03\u5B8C\u6210`),w(c)})},L.isWan())Ie(I,e.uuid);else{const c=me();console.log("\u8D70\u7684\u4E0D\u52A0\u5BC6\u4E0B\u8F7D"),Se(I,e.uuid,c)}};v.push(p)}g++,x=b}return v}async function vt(e,o){let{progressTotal:t,totalSuccessWrap:a,totalFailWrap:s}=o;try{let i=[],u=await ce(`${e.betag}-sequelDownInfo`),w=await ye(u);w.forEach(v=>{i.push({percent:"100.00",loaded:v.size,total:v.size})});let h=_e(i);t(h.percent,h),a(null,new Blob(w))}catch(i){console.error(i),s()}}function bt(e,o,t,a,s,i,u,w){let h=`${i.betag}-${e}-${o-1}`,v={scope:{beginSize:e,endSize:o-1},expires:new Date().getTime()+7*24*60*60*1e3,saveKey:h};return u[t]=v,a[t]={percent:0,loaded:0,total:o-e},{tmpOption:{...s,range:`bytes=${e}-${o-1}`,progress:(g,x)=>{const{loaded:F}=x;a[t].percent=g,a[t].loaded=F;let S=_e(a);w(S.percent,S)}},saveKey:h,index:t}}async function yt(e,o,t,a,s,i){let u=t.split("-"),w=u[2]-u[1];w!=a.size-1&&console.error("saveKey",t,a.size,w);let h=ue(t,a);try{if(e[o]=1,ht(e)){await ue(`${s.betag}-sequelDownInfo`,i),await h;let v=await ye(i);return new Blob(v)}}catch(v){throw console.error("\u5B58\u50A8\u6587\u4EF6\u4E0B\u8F7D\u7F13\u5B58\u5931\u8D25",v),new Error("\u5B58\u50A8\u6587\u4EF6\u4E0B\u8F7D\u7F13\u5B58\u5931\u8D25")}return null}let he=1024*1024*4,te=1024*1024*4;function _t(e){let o=0,t=0;for(let i=0;i<e.length;i++){let u=e[i];u&&(o=o+u.total,t=t+u.loaded)}let a=parseInt(t||"0")/parseInt(o||"100")*100,s=Number(a).toFixed(2);return{total:o,loaded:t,percent:s}}function xt(e,o){if(!o)return!0;for(let t=0;t<o.length;t++){let{start:a,end:s}=o[t];if(a<=parseInt(e)&&e<parseInt(s))return!1}return!0}function At(e,o){let t=Math.ceil(e.size/te),a=0,s=[],i=[];for(;a<t;){let{resolve:u,promise:w}=oe();s.push(w);let h=a*te,v=h+te>=e.size?e.size:h+te,_=(g,x,F)=>async S=>{let d=e.slice(h,v),A=await Oe(d),b=new ve.ArrayBuffer;b.append(A);let I=b.end(!1);A=null,d=null,u({md5sum:I,start:h,end:v,file:e}),S()};a++,i.push(_())}return o.start(i),s}function kt(e){let o="";if(e.length>1){let t=new ve.ArrayBuffer;e.forEach(a=>{t.append(je(a.md5sum))}),o=t.end(!1)}else o=e[0].md5sum;return o}function Ft(e){return e&&(e=e.map(o=>{let{start:t,end:a}=o;return t=t/he,a=a/he,{start:t,end:a}})),e}const fe=1024*1024*2*2,z={},St=X({count:3,retryCount:0});async function It(e,o){return Ut(e,o,St,3)}async function Ct(e,o){const t=e.name;console.time(`${t}\u6587\u4EF6\u8BA1\u7B97Md5`);const a=At(e,o),s=await Promise.all(a);return console.timeEnd(`${t}\u6587\u4EF6\u8BA1\u7B97Md5`),s}async function Ut(e,o,t,a){const s=X({count:a,retryCount:2,openLog:!1,label:"\u4E0A\u4F20\u63A7\u5236\u5668"}),u=(()=>(window.addEventListener("offline",s.pause),window.addEventListener("online",s.continueRun),()=>{window.removeEventListener("offline",s.pause),window.removeEventListener("online",s.continueRun)}))(),w=X({count:6,retryCount:0}),{resolve:h,promise:v}=oe(),_=async g=>{const{file:x}=e,F=x.name;console.time(`${F}\u8BA1\u7B97btag`);const S=await Ct(x,w),d=kt(S);if(console.timeEnd(`${F}\u8BA1\u7B97btag`),z[d]=z[d]||[],z[d].length>0)try{const c=z[d][z[d].length-1];z[d].push(v),await c}catch{}else z[d].push(v);const A=e.success,b=e.fail;e.success=(...c)=>{u(),g(),h(),A(...c)},e.fail=(...c)=>{try{u(),g(),h(),b(c||null),s.stop()}catch(m){console.log(m,"9090")}};const{size:I,type:n,lastModified:r,albumId:p}=x,f=p?2:0;try{const c={fileName:F,folderPath:o,betag:d,size:I,mime:n,createTime:r,albumId:p,BusinessId:f};console.time(`${x.name}\u521B\u5EFA\u4E0A\u4F20\u4EFB\u52A1\u8017\u65F6`);let m=await Ue(c);if(console.timeEnd(`${F}\u521B\u5EFA\u4E0A\u4F20\u4EFB\u52A1\u8017\u65F6`),m.code==200){const{rspType:$,completeInfo:M}=m.results;if($==1)e.progress("100",{loaded:M.size,total:M.size}),e.success(null,{results:M});else{const K=$t(S,e,d,m);K.length!==0&&(s.start(K),e.begin())}}else g(),e.fail(m)}catch(c){setTimeout(()=>{console.error(c),g(),e.fail(c)},2e3)}};return t.start(_),{cancel:(g,x)=>{g==1&&x&&console.log("multipardelete ",Ce(x)),h(),t.removeFn(_),t.next(),s.stop(),w.stop(),u()},pause:()=>{s.pause(),w.pause()},resume:()=>{s.continueRun(),w.continueRun()}}}function $t(e,o,t,a){let s=[];const{file:i,name:u,progress:w,success:h,fail:v}=o,_=async(A,b,I)=>{const n=`${i.name} \u5408\u5E76\u8017\u65F6: `;console.time(n);const r=await $e(A);console.timeEnd(n),r.code==200?h(null,r,I):(console.error(u,"betag:",t,"uploadId",A,"\u539F\u56E0:",r),console.error(`isHttp:${b}`),v(r))},g={uploadId:"0",uploadedParts:[],totalFail:v,paramsArray:e,progressTotal:w,mergePartToOneFile:_},{results:x}=a,{rspType:F,succInfo:S,conflictInfo:d}=x;if(F===0)g.uploadId=S.uploadId;else if(F===2){const{uploadedParts:A}=d;if(A&&A.length===1){const{size:b}=i,{start:I,end:n}=A[0];if(I===0&&n===b)return w("100",{loaded:b,total:b}),_(d.uploadId,!1),s}g.uploadId=d.uploadId,g.uploadedParts=A||[],g.uploadedParts=Ft(A)}return s=Nt(g),s}function Nt(e){const o=[],{uploadedParts:t,uploadId:a,totalFail:s,paramsArray:i,progressTotal:u,mergePartToOneFile:w}=e,h=new Array(i.length);let v=i.length,_=0;for(let g=0;g<i.length;g++)if(!xt(g,t))v--,h[g]={percent:"100",loaded:fe,total:fe};else{const{md5sum:F,start:S,end:d,file:A}=i[g],b=d-S;h[g]={percent:0,loaded:0,total:b};const I={md5sum:F,uploadId:a,start:S,end:d,index:g,file:A.slice(S,d),progress:(r,p)=>{const{loaded:f}=p;h[g]={percent:r,loaded:f,total:b};const c=_t(h);c.uploadId=a,u(c.percent,c)}};console.log("file params",I);const n=()=>{v--,_++,v===0&&w(a,!1,{httpNum:_,totalNum:i.length})};o.push(async r=>{const p=async(f,c)=>{try{if(L.isWan())await Te(f);else{const m=me();await Ne(f,m)}n(),r()}catch(m){if(console.log("fail:",m),m&&(m.code==1037||m.code==1013))n(),r();else{const{start:$,end:M}=f;c===0?(console.log("\u4E0A\u4F20\u6587\u4EF6:",$,"-",M,"\u5931\u8D25"),s(m)):(console.log("\u6539\u4E3Ahttp\u515C\u5E95",$,"-",M),p(f,c-1))}}};p(I,2)})}return o}var Tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAAThJREFUWEft1z9uwjAUBvDvo7Ri6QXYOEPHnodO2YmYIvHvCuUMHbhEIyEEMzdgBkYWIycK7VI5tp+rV5Ws+eNfXpzPz4Syg8o8uINcX+RvVui1MP2y4MH1dhLnW1XoZWyOIPLtFEuSRmLgn57RFlQhCJTdDobrKfepUF6gCkFcaDAfPGHxUfAiDfMHNQJizw6G2wlLSVQ4qFYYEkvzjHyX8yQBiwU1hsMDkW1mXMWipEC1g1j1HpHFRIQsyJqIswFGoREhDvqa82ERkQx0iwhiMehi3jYi0oICIuJ3QB4R8U9BhF373nYzfrpyKm2F7LqnZVKHdgbiFaqC0fZOE7yH9E6yIEVLh5rFVVH7oaZBC/iVXdnz/bzXpA79lVOAdG2D1G0UfUoee22rORQ7iM/9d5CrWuoqdAU+MqklHXUhFQAAAABJRU5ErkJggg==",Bt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAANlJREFUWEdjZBhkgHGQuYdh1EGEYgRnCJk2/Fdi+M0Qg80AJgaGXSdbGU9gkzOu/h/PxMAgj01OQZ+hdXUY4198jsLpIJO6/67//zDswqqZkaH4bCtjHzY5k+r/B///Z7DDJicmwcCxPY/x56iDRkOIYTQNMTAwjOYyaFkwWg6NFoyjVQc4M4wWjKMFI6KFNFowjhaMowXjaMEIKxFGW4yEWoyWDf9Vfv1hSMLWy2RkZNh6ppnxKDY505r/qf8YGBSxySnpMdSS3ZUmNChAK/nR4RhCITvoQggANaqENDWsAKYAAAAASUVORK5CYII=";const Et={0:"downUpload.down_wait",1:"downUpload.down_download",2:"downUpload.down_complete",3:"downUpload.down_fail"},Lt={0:"downUpload.upload_wait",1:"downUpload.upload_download",2:"downUpload.upload_complete",3:"downUpload.upload_fail"},Mt={props:{item:Object,type:String,currentNetWorkType:String|Number},emits:["closeSingleDown","changeTotalProgress","subFailLength","uploadFail","uploadSuccess","downloadSuccess"],data(){return{percent:0,status:0,loaded:0,total:0,speed:"",reson:"",isPause:!1,uploadId:"",pauseedSaveInfo:{res:"",status:0,progress:{percent:0,loaded:0,total:0}},stop:!1,timeBegin:0,timeEnd:0}},computed:{process(){return this.percent>100&&(this.percent=100),this.percent}},mounted(){this.beginRequest(),this.timeBegin=0},methods:{genSrc(){if(this.item)return ae(this.item)},async beginRequest(){const e={name:this.item.name,success:(o,t,a)=>{this.isPause?(this.pauseedSaveInfo.res=t,this.pauseedSaveInfo.status=2):this.changeSuccess(t),setTimeout(()=>{this.loaded!==this.total&&this.changeProgress("100",this.total,this.total)},50),this.statistics(a)},fail:o=>{this.isPause?(this.pauseedSaveInfo.res=o,this.pauseedSaveInfo.status=3):this.changeFail(o)},progress:(o,t)=>{if(this.status===3||this.status===2)return;this.status=1;const{loaded:a,total:s}=t;this.isPause?this.pauseedSaveInfo.progress={percent:o,loaded:a,total:s}:this.changeProgress(o,a,s),t.uploadId&&(this.uploadId=t.uploadId)},autoSave:!1,begin:()=>{if(!(this.status===3||this.status===2)&&(this.status=1,!this.timeBegin)){this.timeBegin=new Date().getTime();const o=this.loaded;this.genSpeed(o)}},type:this.type};this.type==="upload"?(e.file=this.item.file,e.name=this.item.name,this.actionMap=await It(e,this.item.path)):(e.fileSize=this.item.size,this.actionMap=await gt(e,this.item))},statistics(e){this.timeEnd=new Date().getTime();const o=(this.timeEnd-this.timeBegin)/1e3;let t=(this.total/o).toFixed(2);t<1024?t<=0?t="0.00KB/S":t=Number(this.speed).toFixed(2)+"KB/S":t=Number(t/(1024*1024)).toFixed(2)+"MB/S";let a=`\u7EDF\u8BA1\u8017\u65F6-\u6587\u4EF6:${this.item.name},\u5927\u5C0F:${this.genTotalText()}-${this.type=="upload"?"\u4E0A\u4F20":"\u4E0B\u8F7D"}-\u8017\u65F6(${o})s,\u901F\u5EA6:${t}`;e&&(a+=`,\u5176\u4E0A\u4F20\u4E0B\u8F7D\u603B\u6570:${e.totalNum},http\u6570\u91CF:${e.httpNum?e.httpNum:0}`),console.log(a)},changeProgress(e,o,t){this.percent=e,this.loaded=o,this.total=t,this.$emit("changeTotalProgress",this.item.uuid,e)},changeSuccess(e){this.status!==3&&(this.status=2,this.type==="upload"&&this.$emit("uploadSuccess",e),this.type==="download"&&(this.$emit("downloadSuccess",this.item),this.stop||Be.exports.saveAs(e,this.item.name)))},changeFail(e){this.status===2||this.status===3||(this.actionMap&&typeof this.actionMap.cancel=="function"&&this.actionMap.cancel(),this.status=3,this.type==="upload"&&this.$emit("uploadFail"),e&&e.code=="1036"&&(this.reson=this.$t("downUpload.insufficient")),e&&e.code===1003&&(ie.error(this.$t("downUpload.no_exist")),this._sureDelete()))},resumeStatus(){const{status:e,progress:o,res:t}=this.pauseedSaveInfo;if(e===2||e===3){this.status=e,e===2&&this.changeSuccess(t),e===3&&this.changeFail(t);const{percent:a,loaded:s,total:i}=o;this.changeProgress(a,s,i)}},resume(){this.isPause=!1,this.actionMap.resume(),this.resumeStatus()},pause(){this.isPause=!0,this.actionMap.pause()},clearTimeCircle(){this._timeCircle&&clearTimeout(this._timeCircle)},async closeSingleDown(){Ee({title:this.$t("space.delete_file"),content:this.$t("space.delete_content",{name:this.item.name}),sure:()=>{this._sureDelete()},cancel:()=>{console.log("\u53D6\u6D88")}})},_sureDelete(){this.actionMap&&(this.actionMap.cancel(this.status,this.uploadId),this.stop=!0),this.$emit("closeSingleDown",this.item,this.type),this.status===3&&this.$emit("subFailLength")},genSpeed(e){if(this.speed=this.loaded-e,this.speed<1024?(this.speed<0&&(this.speed=0),this.speed=Number(this.speed).toFixed(2)+"KB/S"):this.speed=Number(this.speed/(1024*1024)).toFixed(2)+"MB/S",this.loaded!==this.total||this.loaded===0){const o=this.loaded;this._timeCircle=setTimeout(()=>{this.genSpeed(o)},980)}},genStatusText(){let e;return this.type==="upload"?e=Lt:e=Et,e[this.status]},genContainerStyle(){return this.status==="3"?"background: rgba(51, 122, 255, 0.1);":""},genTotalText(){if(this.total===0)return"";this.genTotalText.totalMb||(this.total<1024*1024?this.genTotalText.totalMb=parseFloat(Number(this.total/(1024*1)).toFixed(2)):this.genTotalText.totalMb=parseFloat(Number(this.total/(1024*1024)).toFixed(2)));const e=this.genTotalText.totalMb;if(this.total===this.loaded)return this.total<1024*1024?`${e}KB/${e}KB`:`${e}MB/${e}MB`;let o=this.loaded/1024;return this.total<1024*1024?(o=parseFloat(Number(o).toFixed(2)),o>e&&(o=e),`${o}KB/${e}KB`):o<1024?`${Number(o).toFixed(2)}KB/${e}MB`:(o=parseFloat(Number(o/1024).toFixed(2)),o>e&&(o=e),`${o}MB/${e}MB`)},genStatusStyle(){return this.status==2?"color:#85899C":this.status==3?"color:#F6222D":""},genAStyle(){return this.loaded!=this.total&&this.percent!=100?"max-width: 90px; display: inline-block;color:#464956 ":"max-width: 150px; display: inline-block;color:#464956 "}},beforeUnmount(){this.clearTimeCircle()}},Dt=["src"],Pt={class:"ml10 mt2 w72"},zt=["title"],Rt={class:"db text fw200"},Wt={key:0,class:"ml40 text fw400 w46"},jt={key:1,class:"ml40 text fw400 w46",style:{opacity:"0"}},Ot={class:"ml36"},Yt={class:"progressContainer"};function Qt(e,o,t,a,s,i){const u=U("Close"),w=U("el-icon");return k(),C("div",{class:"item",style:D(i.genContainerStyle())},[l("img",{src:i.genSrc(),class:"filetype"},null,8,Dt),l("div",Pt,[l("a",{class:"db text fw600 mb2 overflow-ellipsis",style:D(i.genAStyle()),title:t.item.name,href:"javascript:0"},y(t.item.name),13,zt),l("span",Rt,y(i.genTotalText()),1)]),s.loaded!=s.total&&s.percent!=100?(k(),C("span",Wt,y(s.speed),1)):(k(),C("span",jt,"\u5360\u4F4D")),l("div",Ot,[l("div",Yt,[l("div",{class:"progress",style:D({width:i.process+"%"})},null,4)]),s.isPause?(k(),C("span",{key:1,class:"text mt6 dib",style:D(i.genStatusStyle())},y(e.$t("downUpload.state_pause")),5)):(k(),C("span",{key:0,class:"text mt6 dib",style:D(i.genStatusStyle())},y(e.$t(i.genStatusText())+s.reson),5))]),s.isPause&&s.status!=2&&s.status!=3?(k(),C("img",{key:2,src:Tt,style:{width:"18px",height:"18px"},class:"mr-19 ml29 pointer",onClick:o[0]||(o[0]=(...h)=>i.resume&&i.resume(...h))})):J("",!0),!s.isPause&&s.status!=2&&s.status!=3?(k(),C("img",{key:3,src:Bt,style:{width:"18px",height:"18px"},class:"ml29 pointer",onClick:o[1]||(o[1]=(...h)=>i.pause&&i.pause(...h))})):J("",!0),B(w,{onClick:i.closeSingleDown,style:{"font-size":"18px"},class:"pointer ml19"},{default:P(()=>[B(u)]),_:1},8,["onClick"])],4)}var ge=H(Mt,[["render",Qt],["__scopeId","data-v-19c186d2"]]);const se=e=>(le("data-v-0958a6b4"),e=e(),re(),e),Ht={class:"downContainer"},Kt={class:"flex justify-between p20",style:{background:"white"}},Vt={class:"y-center font14"},Gt=se(()=>l("div",{class:"line"},null,-1)),Jt={class:"detail x20"},Xt={class:"x-center y-center y-100 empty"},qt=se(()=>l("img",{src:be},null,-1)),Zt={class:"detail x20"},eo={class:"x-center y-center y-100 empty"},to=se(()=>l("img",{src:be},null,-1)),oo={class:"bottom"},so={class:"y-center"},ao={class:"flex"},io=se(()=>l("img",{src:ut,class:"qiehuan"},null,-1)),no={class:"gray-14"},lo={class:"black-14 fw-b"},ro=["webkitdirectory"],co=ne({__name:"downOrUploadDetail",props:{title:String},setup(e){const o={};let t=De({downList:[],uploadList:[],resouceMap:Le,coverFlag:!1,totalProgress:0,webkitdirectory:!1,failLength:0,floderInfoArr:[],currentType:"download",lastNum:0,addEventFlag:!1,bigUploadList:[],currentNetWorkType:1,showWebRTC:"downUpload.network_wan",totalFileLength:0});Pe(()=>{E.$on("startDownFile",(n,r)=>{const p=v(n);typeof r=="function"&&(p?r(new Error("\u6587\u4EF6\u5DF2\u5B58\u5728")):r())}),E.$on("startuploadFile",(n,r,p)=>{t.floderInfoArr=p,n.length==0?h(r):F(n)}),E.$on("startUploadAlbumFile",n=>{F(n)}),E.$on("showDownUpCover",n=>{t.coverFlag=!0,n===1?t.showWebRTC="downUpload.network_wan":n===2?t.showWebRTC="downUpload.network_lan":n===3&&(t.showWebRTC="downUpload.network_offline")})}),ze(()=>{E.$off("startDownFile"),E.$off("startUploadAlbumFile"),E.$off("showDownUpCover")});function a(){let n=I(),r=t.uploadList.length+t.downList.length-n;r&&!window.onbeforeunload&&(window.onbeforeunload=function(p){p.returnValue=T("downUpload.close_tip")}),r==0&&(window.onbeforeunload=null),E.$emit("unCompletefileNum",r)}function s(n){E.$emit("downloadSuccess",n)}function i(n){if(E.$emit("uploadSuccess",n),t.uploadList.length+t.downList.length-I()<100){let p=setTimeout(()=>{clearTimeout(p),S()},1e3)}}function u(){t.failLength=t.failLength+1}function w(){t.failLength=t.failLength-1}function h(n){t.webkitdirectory=n,Re(()=>{_()})}function v(n){let r=!1,p=[];return n.forEach(f=>{t.downList.find(m=>m.uuid==f.uuid)?p.push(f.name):t.downList.push(f)}),p.length&&(r=!0,ie.info(T("downUpload.file_already_in",{file:p.join(",")}))),a(),r}function _(){document.getElementById("uploadFile").click()}function g(){t.coverFlag=!t.coverFlag}function x(n,r){let p=r=="download"?t.downList:t.uploadList,f=p.findIndex(c=>c.uuid===n.uuid);f!=-1&&p.splice(f,1),a()}function F(n){if(n.length!=0){if(n.length>500){t.totalFileLength=n.length;let r=[];for(let p=0;p<n.length;p++)r.push(n[p]);t.bigUploadList=r,S()}else d(n);document.getElementById("uploadFile").value=""}}function S(){if(t.bigUploadList.length>500){let n=t.bigUploadList.splice(0,500);d(n)}else{let n=t.bigUploadList.splice(0,t.bigUploadList.length);d(n)}}function d(n){for(let r=0;r<n.length;r++){const p=n[r];if(p.size===0)continue;console.log("fileInfo",p);let f="";if(p.webkitRelativePath){const m=p.webkitRelativePath.lastIndexOf("/");m!==-1&&m!==0&&(f=p.webkitRelativePath.slice(0,m+1))}if(t.floderInfoArr.length>0){const m=t.floderInfoArr[t.floderInfoArr.length-1];f=m.path+m.name+"/"+f}else f="/"+f;const c={name:p.name,uuid:Ye(),file:p,path:f};console.log("filePath",c),t.uploadList.push(c),o[c.uuid]=c,a()}}function A(n){let r=[...n.target.files].filter(f=>f.size>0),p=de-t.floderInfoArr.length;for(let f=0;f<r.length;f++){let c=r[f],$=c.webkitRelativePath.split("/");if($.length&&$.length-1>p){ie.info(T("downUpload.folder_limit",{file:c.webkitRelativePath,count:de}));return}}F(r)}const b=(n,r)=>{parseInt(r)==100&&(o[n]={},o[n].downReady=!0,a())};function I(){var r,p;let n=0;for(let f=0;f<t.downList.length;f++){let c=t.downList[f];(r=o[c.uuid])!=null&&r.downReady&&n++}for(let f=0;f<t.uploadList.length;f++){let c=t.uploadList[f];(p=o[c.uuid])!=null&&p.downReady&&n++}return n}return(n,r)=>{const p=U("Close"),f=U("el-icon");return R((k(),Y(we,{class:"center",style:{"z-index":"1000"}},{default:P(()=>[l("div",Ht,[l("div",Kt,[l("div",Vt,[l("span",{class:j(["mr40 pointer common-span",{color337aff:N(t).currentType==="download"}]),onClick:r[0]||(r[0]=c=>N(t).currentType="download")},y(n.$t("downUpload.download_detail")),3),l("span",{class:j(["pointer common-span",{color337aff:N(t).currentType==="upload"}]),onClick:r[1]||(r[1]=c=>N(t).currentType="upload")},y(n.$t("downUpload.upload_detail")),3)]),B(f,{onClick:g,style:{"font-size":"18px"}},{default:P(()=>[B(p)]),_:1})]),Gt,R(l("div",Jt,[(k(!0),C(Q,null,q(N(t).downList,c=>(k(),Y(ge,{key:c.uuid,onCloseSingleDown:x,onUploadSuccess:i,onUploadFail:u,onDownloadSuccess:s,onSubFailLength:w,item:c,onChangeTotalProgress:b,currentNetWorkType:N(t).currentNetWorkType,type:"download"},null,8,["item","currentNetWorkType"]))),128)),R(l("div",Xt,[qt,l("span",null,y(n.$t("downUpload.no_task")),1)],512),[[W,N(t).downList.length==0]])],512),[[W,N(t).currentType==="download"]]),R(l("div",Zt,[(k(!0),C(Q,null,q(N(t).uploadList,c=>(k(),Y(ge,{div:"",key:c.uuid,onCloseSingleDown:x,onUploadSuccess:i,onUploadFail:u,onDownloadSuccess:s,onSubFailLength:w,item:c,onChangeTotalProgress:b,type:"upload",currentNetWorkType:N(t).currentNetWorkType},null,8,["item","currentNetWorkType"]))),128)),R(l("div",eo,[to,l("span",null,y(n.$t("downUpload.no_task")),1)],512),[[W,N(t).uploadList.length==0]])],512),[[W,N(t).currentType=="upload"]]),l("div",oo,[l("div",so,[l("div",ao,[io,l("span",no,y(n.$t("downUpload.network"))+"\uFF1A",1),l("span",lo,y(n.$t(N(t).showWebRTC)),1)])])]),l("input",{type:"file",name:"file",id:"uploadFile",onChange:A,style:{display:"none"},webkitdirectory:!!N(t).webkitdirectory},null,40,ro)])]),_:1},512)),[[W,N(t).coverFlag]])}}});var uo=H(co,[["__scopeId","data-v-0958a6b4"]]);const po={props:{item:Object},emits:["callback"],data(){return{actionNameMap:{1:T("notify.create"),2:T("notify.move"),3:T("notify.delete"),4:T("notify.rename"),5:T("notify.copy"),6:T("notify.restore"),7:T("notify.clear_restore")},statusMap:{1:T("notify.wait_execution"),2:T("notify.opera_fail"),3:T("notify.opera_suc")},statusName:"",actionName:"",fileName:"",targetFileInfo:{}}},computed:{moreFile(){return Array.isArray(this.item.targetFileInfo)&&this.item.targetFileInfo.length>1}},mounted(){this.statusName=this.statusMap[this.item.status],this.actionName=this.actionNameMap[this.item.actionType],Array.isArray(this.item.targetFileInfo)?this.targetFileInfo=this.item.targetFileInfo[0]:this.targetFileInfo=this.item.targetFileInfo,this.moreFile?this.fileName=T("notify.many_files",{name:this.targetFileInfo.name,count:this.item.targetFileInfo.length}):this.fileName=this.targetFileInfo.name,setTimeout(()=>{this.$emit("callback",{action:this.actionName,fileName:this.fileName,reason:this.statusName})},500)},methods:{genTime(){return Qe(this.targetFileInfo.createdAt).format("YYYY-MM-DD HH:mm:ss")},genSrc(){return this.moreFile?ae({is_moreFile:!0}):ae(this.targetFileInfo)}}},ho={class:"flex y-center",style:{width:"200px"}},fo=["src"],go={class:"ml10 fw500 color-one overflow-ellipsis w95"},mo={class:"color-three"},wo={class:"color-two"};function vo(e,o,t,a,s,i){return k(),C("div",{class:"item font12",style:D({"background: rgba(51, 122, 255, 0.1);":t.item.status===3})},[l("div",ho,[l("img",{src:i.genSrc(),class:"filetype"},null,8,fo),l("span",go,y(s.fileName),1)]),l("div",null,[l("span",mo,y(s.actionName),1)]),l("div",null,y(i.genTime()),1),l("div",wo,y(s.statusName),1)],4)}var bo=H(po,[["render",vo],["__scopeId","data-v-22652ab6"]]);const yo=ne({props:{type:String,title:String},components:{cover:we,actionItem:bo},data(){return{jobList:[],coverFlag:!1,action:"",fileName:"",reason:""}},mounted(){E.$on("jobListChange",e=>{this.jobList=e})},methods:{showCover(){this.coverFlag=!1},callback({action:e,fileName:o,reason:t}){this.action=e,this.fileName=o,this.reason=t}}}),_o=e=>(le("data-v-f7d0d7f4"),e=e(),re(),e),xo={class:"bottomContainer"},Ao={class:"bleft text"},ko={class:"color337aff"},Fo={class:"bright font12 color337aff pointer inline-block"},So={class:"flex justify-between m20"},Io=_o(()=>l("div",{class:"line"},null,-1));function Co(e,o,t,a,s,i){const u=U("Close"),w=U("el-icon"),h=U("actionItem"),v=U("cover");return k(),C(Q,null,[l("div",null,[R(l("div",xo,[l("div",Ao,[We(y(e.action)+" ",1),l("span",ko,y(e.fileName),1)]),l("div",null,[l("div",Fo,y(e.reason),1),l("div",{class:"bright font12 color337aff pointer inline-block ml20",onClick:o[0]||(o[0]=_=>e.coverFlag=!0)},y(e.$t("space.view_details")),1)])],512),[[W,e.jobList.length>0]])]),R(B(v,{class:"center",style:{"z-index":"1000"}},{default:P(()=>[l("div",{class:"downContainer",style:D({"height:574px":e.type==="upload"})},[l("div",So,[l("span",null,y(e.$t("space.task_list")),1),B(w,{onClick:e.showCover,style:{"font-size":"18px"},class:"close"},{default:P(()=>[B(u)]),_:1},8,["onClick"])]),Io,l("div",{class:"detail x20",style:D({"height:76%":e.type==="upload"})},[(k(!0),C(Q,null,q(e.jobList,(_,g)=>(k(),Y(h,{key:_.jobId+g,item:_,onCallback:e.callback},null,8,["item","onCallback"]))),128))],4)],4)]),_:1},512),[[W,e.coverFlag]])],64)}var Uo=H(yo,[["render",Co],["__scopeId","data-v-f7d0d7f4"]]);let G;function xe(){return He().then(e=>{let o=!0;e.status=="ok"&&e.message&&(o=!1,G&&clearTimeout(G),Ke(e.message).then(t=>{if(Array.isArray(t)&&t.length&&location.hash!="#/login"&&location.hash!="#/noscanLogin"){let a=Ve(t[0]);E.$emit(a.eventName,a)}})),o&&(G=setTimeout(xe,3e3))}),()=>{G&&clearTimeout(G)}}var $o="./assets/logo.7ddba080.png",No="./assets/logo_en.3a4ded4d.png",To="./assets/change.859e4cdf.svg";const Bo={name:"NetworkModeSwitch",data(){return{showSwitch:!1,switchText:"login.switchLan",boxLanInfo:{},currentNet:0}},mounted(){L.init(),this.boxLanInfo=Ge(),E.$on(L.NetworkChangeEvent,this.networkChangeEvent),L.isWan()&&setTimeout(this.pingLan,1e4)},methods:{pingLan(){L.pingLan().then(()=>{this.currentNet=2,this.showSwitchDialog()}).catch(()=>{L.pingIp().then(()=>{this.currentNet=3,this.showSwitchDialog()}).catch(()=>{setTimeout(this.pingLan,1e4)})})},networkSwitch(){let e=localStorage.getItem(O.eluoxaeskey),o=localStorage.getItem(O.serPubkey),t=localStorage.getItem(O.language),a=localStorage.getItem(O.loginInfo),s=localStorage.getItem(O.clientUUID),i="#/switchLogin?eluoxaeskey="+encodeURIComponent(e)+"&serPubkey="+encodeURIComponent(o)+"&loginInfo="+encodeURIComponent(a)+"&language="+t+"&client_uuid="+s,u;this.currentNet===1?u="https://"+this.boxLanInfo.userDomain+"/space/index.html":this.currentNet===2?u="https://"+this.boxLanInfo.lanDomain+":"+this.boxLanInfo.tlsPort+"/space/index.html":u="http://"+this.boxLanInfo.lanIp+":"+this.boxLanInfo.port+"/space/index.html",Je(u),setTimeout(()=>{window.location.href=u+i},1e3)},networkChangeEvent(e){e===3&&(L.isWan()?L.pingIp().then(()=>{this.switchText="login.switchLan",this.currentNet=3,this.showSwitchDialog()}).catch(()=>{setTimeout(()=>{this.networkChangeEvent(e)},5e3)}):L.pingWan().then(()=>{this.switchText="login.switchWan",this.currentNet=1,this.showSwitchDialog()}).catch(()=>{setTimeout(()=>{this.networkChangeEvent(e)},5e3)}))},showSwitchDialog(){this.showSwitch=!0,setTimeout(()=>{this.showSwitch=!1},5e3)}}},Eo=e=>(le("data-v-4ee688d1"),e=e(),re(),e),Lo=Eo(()=>l("img",{alt:"",class:"mr-10",src:To},null,-1)),Mo={class:"black56-14"};function Do(e,o,t,a,s,i){return k(),C("div",{class:j(["flex-xy-center netSwitch",{showSwitch:s.showSwitch,hideSwitch:!s.showSwitch}])},[Lo,l("div",Mo,y(e.$t(s.switchText)),1),l("div",{class:"button-blue ml-10 font-12",onClick:o[0]||(o[0]=(...u)=>i.networkSwitch&&i.networkSwitch(...u))},y(e.$t("login.switchNow")),1)],2)}var Po=H(Bo,[["render",Do],["__scopeId","data-v-4ee688d1"]]);const zo=ne({name:"home",components:{downOrUploadDetail:uo,jobActionList:Uo,loginOut:ke,NetworkModeSwitch:Po},setup(){Xe.getAllDirStruct({})},computed:{getLogoImg(){return qe()?$o:No}},beforeMount(){this.persapi()},data(){return{personalName:"",isCollapse:!1,leftMenu:[{name:"router.home_file",routeName:["/home/space","/home/file"],routeUrl:"/home/space",imgPath:lt,imggrayPath:rt,child:[{name:"router.me_recycle_bin",routeUrl:"/home/recycle",imgPath:""}]},{name:"router.my_setting",routeUrl:"/home/setting",imgPath:ct,imggrayPath:dt}],showLoginOut:!1,spaceSizeTotal:0,spaceSizeUsed:0,spacePercentage:0,flag:0}},beforeUnmount(){this.cancelPollFunction&&this.cancelPollFunction()},mounted(){at(),this.cancelPollFunction=xe(),pe().then(e=>{e.code==="AG-200"&&localStorage.setItem(O.deviceModelNumber,e.results.deviceModelNumber)}),Ze().then(e=>{et(e.platformInfo.platformUrl)})},methods:{goAoMain(){this.$router.push("/home/index")},childAction(e){e.showChild=!e.showChild},gotoView(e){this.$router.push(e.routeUrl)},getArrow(e,o){return this.isSelected(e,o)?e.showChild?nt:Fe:e.showChild?Me:it},isSelected(e,o){if(e.routeName){for(let t of e.routeName)if(o.indexOf(t)>-1)return!0}return e.routeUrl.indexOf(o)>-1},persapi(){tt().then(e=>{e.code==="ACC-200"&&(this.personalName=e.results[0].personalName,pe().then(o=>{o.code==="AG-200"&&(o.results.deviceModelNumber>=-299&&o.results.deviceModelNumber<=-200?this.storapiTrial(e.results[0].aoId):this.storapi())}))})},storapi(){ot().then(e=>{this.spaceSizeTotal=Z(e.spaceSizeTotal),this.spaceSizeUsed=Z(e.spaceSizeUsed),this.spacePercentage=this.spaceSizeUsed/this.spaceSizeTotal*100,isNaN(this.spacePercentage)&&(this.spacePercentage=0)})},storapiTrial(e){st(e).then(o=>{console.log("home storage",o),o.code==="200"&&(this.spaceSizeTotal=Z(o.results.totalStorage),this.spaceSizeUsed=Z(o.results.userStorage),this.spacePercentage=this.spaceSizeUsed/this.spaceSizeTotal*100,isNaN(this.spacePercentage)&&(this.spacePercentage=0))})}}}),Ro=["src"],Wo=["onClick"],jo=["src"],Oo=["src","onClick"],Yo=["onClick"],Qo={class:"boxInfo"},Ho={class:"flex y-center personInfo"},Ko={class:"ml10 nickName"},Vo={style:{"padding-top":"13px",color:"#85899c","margin-bottom":"37px"}},Go={class:"download"};function Jo(e,o,t,a,s,i){const u=U("loginOut"),w=U("el-progress"),h=U("el-aside"),v=U("router-view"),_=U("downOrUploadDetail"),g=U("jobActionList"),x=U("NetworkModeSwitch"),F=U("el-main"),S=U("el-container");return k(),Y(S,null,{default:P(()=>[B(h,{class:"leftMenu"},{default:P(()=>[l("div",null,[l("img",{class:"logo pointer",src:e.getLogoImg,onClick:o[0]||(o[0]=d=>e.goAoMain())},null,8,Ro),(k(!0),C(Q,null,q(e.leftMenu,(d,A)=>(k(),C("div",null,[l("div",{class:j(["item y-center",e.isSelected(d,e.$route.path)?"is-active":""])},[l("div",{class:"action y-center",onClick:b=>e.gotoView(d)},[d.imgPath?(k(),C("img",{key:0,src:e.isSelected(d,e.$route.path)?d.imgPath:d.imggrayPath,class:"lifang"},null,8,jo)):J("",!0),l("div",{class:j({"color-337aff":e.isSelected(d,e.$route.path)})},y(e.$t(d.name)),3)],8,Wo),d.child?(k(),C("img",{key:0,src:e.getArrow(d,e.$route.path),class:"arrow",onClick:b=>e.childAction(d)},null,8,Oo)):J("",!0)],2),d.showChild?J("",!0):(k(!0),C(Q,{key:0},q(d.child,b=>(k(),C("div",{class:j(["item y-center",e.isSelected(b,e.$route.path)?"is-active":""])},[l("div",{class:"action y-center",onClick:I=>e.gotoView(b)},[l("div",{class:j(["ml37",{"color-337aff":e.isSelected(b,e.$route.path)}])},y(e.$t(b.name)),3)],8,Yo)],2))),256))]))),256))]),l("div",Qo,[l("div",Ho,[B(u),l("span",Ko,y(e.personalName),1)]),B(w,{percentage:e.spacePercentage,"stroke-width":7,"show-text":!1,color:"#337AFF"},null,8,["percentage"]),l("div",Vo,y(e.spaceSizeUsed)+"/"+y(e.spaceSizeTotal),1)])]),_:1}),B(F,null,{default:P(()=>[(k(),Y(v,{key:e.$route.fullPath})),l("div",Go,[B(_),B(g)]),B(x)]),_:1})]),_:1})}var cs=H(zo,[["render",Jo],["__scopeId","data-v-3efa6c96"]]);export{cs as default};
